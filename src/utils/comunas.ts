export const comunasPorRegion: Record<string, string[]> = {
  "Región de Arica y Parinacota": [
    "Arica",
    "Camarones",
    "Putre",
    "General Lagos",
  ],
  "Región de Tarapacá": [
    "Iquique",
    "Alto Hospicio",
    "Pozo Almonte",
    "Camiña",
    "Colchane",
    "Huara",
  ],
  "Región de Antofagasta": [
    "Antofagasta",
    "Mejillones",
    "Sierra Gorda",
    "Taltal",
    "Calama",
    "Ollagüe",
    "San Pedro de Atacama",
    "Tocopilla",
  ],
  "Región de Atacama": [
    "Copiapó",
    "Tierra Amarilla",
    "Caldera",
    "Chañaral",
    "Diego de Almagro",
    "Vallenar",
  ],
  "Región de Coquimbo": [
    "La Serena",
    "Coquimbo",
    "Andacollo",
    "La Higuera",
    "Vicuña",
    "Paiguano",
    "Ovalle",
    "Combarbalá",
    "Monte Patria",
    "Punitaqui",
    "Río Hurtado",
  ],
  "Región de Valparaíso": [
    "Valparaíso",
    "Viña del Mar",
    "Quintero",
    "Villa Alemana",
    "Concón",
    "Casablanca",
    "Quilpué",
    "Olmué",
    "Limache",
    "Nogales",
    "La Ligua",
    "Cabildo",
    "Puchuncaví",
    "Zapallar",
    "Isla de Pascua",
    "Juan Fernández",
    "San Antonio",
    "El Tabo",
    "El Quisco",
    "Algarrobo",
    "Catemu",
    "Llay Llay",
    "Hijuelas",
    "La Cruz",
    "Quillota",
  ],
  "Región Metropolitana de Santiago": [
    "Cerrillos",
    "Cerro Navia",
    "Conchalí",
    "El Bosque",
    "Estación Central",
    "Huechuraba",
    "Independencia",
    "La Cisterna",
    "La Florida",
    "La Granja",
    "La Reina",
    "Las Condes",
    "Lo Barnechea",
    "Lo Espejo",
    "Lo Prado",
    "Macul",
    "Maipú",
    "Ñuñoa",
    "Pedro Aguirre Cerda",
    "Peñalolén",
    "Providencia",
    "Pudahuel",
    "Quilicura",
    "Quinta Normal",
    "Recoleta",
    "Renca",
    "San Joaquín",
    "San Miguel",
    "San Ramón",
    "Santiago",
    "Vitacura",
    "Puente Alto",
    "Pirque",
    "San José de Maipo",
    "Colina",
    "Lampa",
    "Tiltil",
    "Buin",
    "Calera de Tango",
    "Paine",
    "Melipilla",
    "Alhué",
    "Curacaví",
    "María Pinto",
    "San Bernardo",
  ],
  "Región del Libertador General Bernardo O'Higgins": [
    "Rancagua",
    "San Fernando",
    "Rengo",
    "Machalí",
    "Mostazal",
    "Doñihue",
    "Coinco",
    "Graneros",
    "Las Cabras",
    "Malloa",
    "Nancagua",
    "Palmilla",
    "Peralillo",
    "Pichidegua",
    "Placilla",
    "Pumanque",
    "Quinta de Tilcoco",
    "Requínoa",
  ],
  "Región del Maule": [
    "Talca",
    "Curicó",
    "Linares",
    "Parral",
    "Constitución",
    "Cauquenes",
    "Pencahue",
    "San Javier",
    "Molina",
    "Rauco",
    "Teno",
    "Villa Alegre",
    "Longaví",
    "Empedrado",
    "Retiro",
    "Hualañé",
    "Colbún",
    "Pelarco",
    "Romeral",
    "Sagrada Familia",
  ],
  "Región del Biobío": [
    "Concepción",
    "Talcahuano",
    "Coronel",
    "Hualqui",
    "Lota",
    "Los Ángeles",
    "Cabrero",
    "Chiguayante",
    "Florida",
    "Hualpén",
    "Lebu",
    "Lota",
    "Mulchén",
    "Nacimiento",
    "Penco",
    "San Pedro de la Paz",
    "Santa Juana",
    "Tome",
    "Yumbel",
    "Curanilahue",
    "Arauco",
    "Cañete",
    "Tirúa",
    "Tucapel",
    "Negrete",
  ],
  "Región de La Araucanía": [
    "Temuco",
    "Villarrica",
    "Angol",
    "Loncoche",
    "Pitrufquén",
    "Carahue",
    "Freire",
    "Gorbea",
    "Lautaro",
    "Loncoche",
    "Nueva Imperial",
    "Padre Las Casas",
    "Perquenco",
    "Pucón",
    "Saavedra",
    "Teodoro Schmidt",
  ],
  "Región de Los Ríos": [
    "Valdivia",
    "La Unión",
    "Panguipulli",
    "Río Bueno",
    "Lago Ranco",
    "Futrono",
    "Mariquina",
    "Máfil",
  ],
  "Región de Los Lagos": [
    "Puerto Montt",
    "Castro",
    "Osorno",
    "Ancud",
    "Calbuco",
    "Chaitén",
    "Fresia",
    "Frutillar",
    "Llanquihue",
    "Maullín",
    "Palena",
    "Puerto Varas",
    "Quellón",
    "Quinchao",
    "Puqueldón",
  ],
  "Región de Aysén del General Carlos Ibáñez del Campo": [
    "Coyhaique",
    "Aysén",
    "Cisnes",
    "Guaitecas",
    "Chile Chico",
    "Cochrane",
    "O’Higgins",
    "Río Ibáñez",
  ],
  "Región de Magallanes y de la Antártica Chilena": [
    "Punta Arenas",
    "Porvenir",
    "Puerto Natales",
    "Cabo de Hornos",
    "Laguna Blanca",
    "Río Verde",
  ],
  "Región de Ñuble": [
    "Chillán",
    "Chillán Viejo",
    "San Carlos",
    "Ninhue",
    "Pemuco",
    "Pinto",
    "Quillón",
    "Ránquil",
    "San Ignacio",
    "Yungay",
    "Coelemu",
    "Bulnes",
    "El Carmen",
    "Portezuelo",
  ],
};

export type ComunasOptions = {
  regionSelectId?: string;
  comunaSelectId?: string;
  defaultOptionText?: string;
};

export function initComunas(options?: ComunasOptions): void {
  const {
    regionSelectId = "region",
    comunaSelectId = "comuna",
    defaultOptionText = "Seleccione la comuna...",
  } = options || {};

  const regionSelect = document.getElementById(
    regionSelectId
  ) as HTMLSelectElement | null;
  const comunaSelect = document.getElementById(
    comunaSelectId
  ) as HTMLSelectElement | null;

  if (!regionSelect) {
    console.warn(`initComunas: elemento #${regionSelectId} no encontrado.`);
    return;
  }
  if (!comunaSelect) {
    console.warn(`initComunas: elemento #${comunaSelectId} no encontrado.`);
    return;
  }

  const comunaSelectEl = comunaSelect as HTMLSelectElement;
  const regionSelectEl = regionSelect as HTMLSelectElement;

  function populateComunas(regionKey: string | null) {
    comunaSelectEl.innerHTML = "";
    const placeholder = document.createElement("option");
    placeholder.selected = true;
    placeholder.disabled = true;
    placeholder.textContent = defaultOptionText;
    comunaSelectEl.appendChild(placeholder);

    if (!regionKey) return;
    const lista = comunasPorRegion[regionKey];
    if (!lista) return;
    lista.forEach((comuna) => {
      const option = document.createElement("option");
      option.value = comuna;
      option.textContent = comuna;
      comunaSelectEl.appendChild(option);
    });
  }

  // Inicializar con el valor actual
  populateComunas(regionSelectEl.value || null);

  regionSelectEl.addEventListener("change", function () {
    populateComunas((this as HTMLSelectElement).value || null);
  });
}

// Auto-inicializar si el DOM ya está cargado o cuando lo esté
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", () => initComunas());
} else {
  initComunas();
}

export default initComunas;
